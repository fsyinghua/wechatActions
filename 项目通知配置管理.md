# é¡¹ç›®ä¼ä¸šå¾®ä¿¡é€šçŸ¥é…ç½®ç®¡ç†æ–¹æ¡ˆ

## ä¸€ã€é…ç½®çŠ¶æ€è®°å½•æ–‡æ¡£

åˆ›å»ºä¸€ä¸ªä¸­å¤®ç®¡ç†æ–‡æ¡£ï¼Œç”¨äºè®°å½•æ‰€æœ‰é¡¹ç›®çš„é€šçŸ¥é…ç½®çŠ¶æ€ã€‚æ¨èä½¿ç”¨**ç”µå­è¡¨æ ¼**ï¼ˆå¦‚Excelã€Google Sheetsï¼‰æˆ–**Markdownè¡¨æ ¼**ã€‚

### 1.1 ç”µå­è¡¨æ ¼æ¨¡æ¿

| é¡¹ç›®åç§° | ä»“åº“åœ°å€ | é…ç½®çŠ¶æ€ | é…ç½®æ—¥æœŸ | æœ€åéªŒè¯æ—¥æœŸ | è´Ÿè´£äºº | å¤‡æ³¨ |
|---------|---------|---------|---------|-------------|-------|------|
| é¡¹ç›®A | https://github.com/ç»„ç»‡/é¡¹ç›®A | âœ… å·²é…ç½® | 2023-12-01 | 2023-12-01 | å¼ ä¸‰ | - |
| é¡¹ç›®B | https://github.com/ç»„ç»‡/é¡¹ç›®B | âš ï¸ å¾…é…ç½® | - | - | æå›› | ä¼˜å…ˆçº§é«˜ |
| é¡¹ç›®C | https://github.com/ç»„ç»‡/é¡¹ç›®C | âŒ ä¸é…ç½® | - | - | ç‹äº” | å†…éƒ¨æµ‹è¯•é¡¹ç›® |

### 1.2 ä»“åº“å†…Markdownæ–‡æ¡£

åœ¨é€šçŸ¥ç®¡ç†ä»“åº“ä¸­åˆ›å»º `projects-config.md` æ–‡ä»¶ï¼Œå®šæœŸæ›´æ–°ï¼š

```markdown
# é¡¹ç›®é€šçŸ¥é…ç½®çŠ¶æ€

## å·²é…ç½®é¡¹ç›®

| é¡¹ç›®åç§° | ä»“åº“åœ°å€ | é…ç½®æ—¥æœŸ |
|---------|---------|---------|
| é¡¹ç›®A | [é“¾æ¥](https://github.com/ç»„ç»‡/é¡¹ç›®A) | 2023-12-01 |
| é¡¹ç›®B | [é“¾æ¥](https://github.com/ç»„ç»‡/é¡¹ç›®B) | 2023-12-02 |

## å¾…é…ç½®é¡¹ç›®

| é¡¹ç›®åç§° | ä»“åº“åœ°å€ | ä¼˜å…ˆçº§ |
|---------|---------|-------|
| é¡¹ç›®C | [é“¾æ¥](https://github.com/ç»„ç»‡/é¡¹ç›®C) | é«˜ |
| é¡¹ç›®D | [é“¾æ¥](https://github.com/ç»„ç»‡/é¡¹ç›®D) | ä¸­ |

## ä¸é…ç½®é¡¹ç›®

| é¡¹ç›®åç§° | ä»“åº“åœ°å€ | åŸå›  |
|---------|---------|-----|
| é¡¹ç›®E | [é“¾æ¥](https://github.com/ç»„ç»‡/é¡¹ç›®E) | å†…éƒ¨æµ‹è¯•é¡¹ç›® |
```

## äºŒã€æ‰¹é‡ç®¡ç†è„šæœ¬

åˆ›å»ºè„šæœ¬å·¥å…·ï¼Œç”¨äºæ‰¹é‡æ£€æŸ¥å’Œæ›´æ–°é¡¹ç›®çš„é€šçŸ¥é…ç½®ã€‚

### 2.1 æ£€æŸ¥é…ç½®çŠ¶æ€è„šæœ¬

**check-config.js**
```javascript
const { execSync } = require('child_process');
const fs = require('fs');

// è¯»å–é¡¹ç›®åˆ—è¡¨
const projects = fs.readFileSync('projects.txt', 'utf8').split('\n').filter(Boolean);
const results = [];

projects.forEach(project => {
  try {
    // å…‹éš†ä»“åº“ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
    if (!fs.existsSync(project)) {
      execSync(`git clone https://github.com/ç»„ç»‡/${project}.git`, { stdio: 'ignore' });
    }
    
    // æ£€æŸ¥æ˜¯å¦å­˜åœ¨é€šçŸ¥é…ç½®æ–‡ä»¶
    const hasConfig = fs.existsSync(`${project}/.github/workflows/wechat-notification.yml`);
    results.push({ project, hasConfig });
    
    console.log(`${project}: ${hasConfig ? 'âœ… å·²é…ç½®' : 'âŒ æœªé…ç½®'}`);
  } catch (error) {
    console.error(`${project}: âš ï¸  æ£€æŸ¥å¤±è´¥ - ${error.message}`);
  }
});

// ç”ŸæˆæŠ¥å‘Š
fs.writeFileSync('config-report.md', `# é…ç½®çŠ¶æ€æŠ¥å‘Š\n\n${results.map(r => `- ${r.project}: ${r.hasConfig ? 'âœ… å·²é…ç½®' : 'âŒ æœªé…ç½®'}`).join('\n')}`);
```

### 2.2 æ‰¹é‡éƒ¨ç½²é…ç½®è„šæœ¬

**deploy-config.js**
```javascript
const { execSync } = require('child_process');
const fs = require('fs');

// è¯»å–å¾…é…ç½®é¡¹ç›®åˆ—è¡¨
const projects = fs.readFileSync('to-deploy.txt', 'utf8').split('\n').filter(Boolean);
const configTemplate = fs.readFileSync('wechat-notification-template.yml', 'utf8');

projects.forEach(project => {
  try {
    console.log(`æ­£åœ¨é…ç½®é¡¹ç›®: ${project}`);
    
    // å…‹éš†æˆ–æ›´æ–°ä»“åº“
    if (fs.existsSync(project)) {
      execSync(`cd ${project} && git pull`, { stdio: 'ignore' });
    } else {
      execSync(`git clone https://github.com/ç»„ç»‡/${project}.git`, { stdio: 'ignore' });
    }
    
    // åˆ›å»ºé…ç½®ç›®å½•
    fs.mkdirSync(`${project}/.github/workflows`, { recursive: true });
    
    // å†™å…¥é…ç½®æ–‡ä»¶
    fs.writeFileSync(`${project}/.github/workflows/wechat-notification.yml`, configTemplate);
    
    // æäº¤å¹¶æ¨é€
    execSync(`cd ${project} && git add . && git commit -m "Add wechat notification config" && git push`, { stdio: 'ignore' });
    
    console.log(`${project}: âœ… é…ç½®æˆåŠŸ`);
  } catch (error) {
    console.error(`${project}: âš ï¸  é…ç½®å¤±è´¥ - ${error.message}`);
  }
});
```

## ä¸‰ã€GitHub Actionsè‡ªåŠ¨æ£€æŸ¥æœºåˆ¶

åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨åŒ–å·¥ä½œæµï¼Œå®šæœŸæ£€æŸ¥æ‰€æœ‰é¡¹ç›®çš„é…ç½®çŠ¶æ€ã€‚

### 3.1 é…ç½®æ£€æŸ¥å·¥ä½œæµ

**check-all-projects.yml**
```yaml
name: æ£€æŸ¥æ‰€æœ‰é¡¹ç›®é€šçŸ¥é…ç½®

on:
  schedule:
    - cron: '0 0 * * 1'  # æ¯å‘¨ä¸€å‡Œæ™¨æ‰§è¡Œ
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  check-configs:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºé…ç½®ç®¡ç†ä»“åº“
        uses: actions/checkout@v4

      - name: è®¾ç½®Node.jsç¯å¢ƒ
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: å®‰è£…ä¾èµ–
        run: npm install @octokit/rest

      - name: æ£€æŸ¥æ‰€æœ‰é¡¹ç›®é…ç½®
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: node scripts/check-all-projects.js

      - name: ç”Ÿæˆé…ç½®æŠ¥å‘Š
        run: node scripts/generate-report.js

      - name: å‘é€é…ç½®çŠ¶æ€é€šçŸ¥
        uses: actions/github-script@v7
        with:
          script: |
            const axios = require('axios');
            const report = require('./config-report.json');
            
            // ç”Ÿæˆé€šçŸ¥å†…å®¹
            let content = `## ğŸ“Š é¡¹ç›®é€šçŸ¥é…ç½®çŠ¶æ€æŠ¥å‘Š\n\n`;
            content += `**æ£€æŸ¥æ—¶é—´**: ${new Date().toLocaleString()}\n`;
            content += `**æ€»é¡¹ç›®æ•°**: ${report.total}\n`;
            content += `**å·²é…ç½®**: ${report.configured}\n`;
            content += `**æœªé…ç½®**: ${report.notConfigured}\n\n`;
            
            if (report.notConfigured > 0) {
              content += `**æœªé…ç½®é¡¹ç›®**:\n`;
              report.missing.forEach(project => {
                content += `- ${project}\n`;
              });
            }
            
            // å‘é€é€šçŸ¥
            await axios.post(process.env.WECHAT_WEBHOOK_URL, {
              msgtype: 'markdown',
              markdown: { content }
            });
        env:
          WECHAT_WEBHOOK_URL: ${{ secrets.WECHAT_WEBHOOK_URL }}

      - name: æäº¤æŠ¥å‘Š
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add config-report.json config-report.md
          git commit -m "Update config report"
          git push
```

## å››ã€æ–°é¡¹ç›®è‡ªåŠ¨é…ç½®æœºåˆ¶

### 4.1 ä½¿ç”¨GitHubç»„ç»‡çº§æ¨¡æ¿

1. è¿›å…¥GitHubç»„ç»‡ â†’ `Settings` â†’ `Repository templates`
2. é€‰æ‹©ä¸€ä¸ªå·²é…ç½®é€šçŸ¥çš„é¡¹ç›®ä½œä¸ºæ¨¡æ¿
3. å‹¾é€‰ `Use this repository as a template for all new repositories`
4. æ–°åˆ›å»ºçš„é¡¹ç›®å°†è‡ªåŠ¨ç»§æ‰¿é€šçŸ¥é…ç½®

### 4.2 ä½¿ç”¨GitHub Actionsç›‘å¬æ–°ä»“åº“åˆ›å»º

**new-repo-notification.yml**
```yaml
name: æ–°ä»“åº“è‡ªåŠ¨é…ç½®é€šçŸ¥

on:
  repository_dispatch:
    types: [repository_created]

jobs:
  configure-new-repo:
    runs-on: ubuntu-latest
    steps:
      - name: é…ç½®æ–°ä»“åº“é€šçŸ¥
        uses: actions/github-script@v7
        with:
          script: |
            const { Octokit } = require('@octokit/rest');
            const octokit = new Octokit({ auth: process.env.GITHUB_TOKEN });
            
            // è·å–æ–°ä»“åº“ä¿¡æ¯
            const repo = context.payload.repository;
            const owner = repo.owner.login;
            const repoName = repo.name;
            
            // è¯»å–é…ç½®æ¨¡æ¿
            const configTemplate = await octokit.rest.repos.getContent({
              owner: context.repo.owner,
              repo: context.repo.repo,
              path: 'wechat-notification-template.yml'
            });
            
            const configContent = Buffer.from(configTemplate.data.content, 'base64').toString();
            
            // å†™å…¥é…ç½®åˆ°æ–°ä»“åº“
            await octokit.rest.repos.createOrUpdateFileContents({
              owner,
              repo: repoName,
              path: '.github/workflows/wechat-notification.yml',
              message: 'Add wechat notification config',
              content: Buffer.from(configContent).toString('base64')
            });
            
            console.log(`âœ… å·²ä¸ºæ–°ä»“åº“ ${repo.full_name} é…ç½®é€šçŸ¥`);
```

## äº”ã€æœ€ä½³å®è·µå»ºè®®

### 5.1 é…ç½®æ ‡å‡†åŒ–

- ç»Ÿä¸€ä½¿ç”¨ç›¸åŒçš„é…ç½®æ–‡ä»¶åç§°ï¼š`wechat-notification.yml`
- ç»Ÿä¸€é€šçŸ¥æ¨¡æ¿æ ¼å¼ï¼Œç¡®ä¿ä¿¡æ¯ä¸€è‡´æ€§
- ç»Ÿä¸€äº‹ä»¶ç›‘å¬è§„åˆ™ï¼Œä¾¿äºç®¡ç†å’Œç»´æŠ¤

### 5.2 æƒé™ç®¡ç†

- ä½¿ç”¨ç»„ç»‡çº§Secretsç®¡ç†ä¼ä¸šå¾®ä¿¡Webhook URL
- é™åˆ¶é…ç½®æ–‡ä»¶çš„ä¿®æ”¹æƒé™ï¼Œé˜²æ­¢è¯¯æ“ä½œ
- å®šæœŸå®¡æŸ¥é…ç½®æ–‡ä»¶çš„å˜æ›´è®°å½•

### 5.3 å®šæœŸç»´æŠ¤

- æ¯å‘¨è¿è¡Œä¸€æ¬¡é…ç½®æ£€æŸ¥ï¼Œæ›´æ–°çŠ¶æ€æŠ¥å‘Š
- æ¯æœˆå®¡æŸ¥ä¸€æ¬¡é€šçŸ¥æ•ˆæœï¼Œä¼˜åŒ–æ¨¡æ¿
- æ¯å­£åº¦æ›´æ–°ä¸€æ¬¡é…ç½®æ–‡ä»¶ï¼Œé€‚é…æ–°åŠŸèƒ½

### 5.4 åŸ¹è®­ä¸æ–‡æ¡£

- ä¸ºå›¢é˜Ÿæˆå‘˜æä¾›é…ç½®æŒ‡å—
- å»ºç«‹å¸¸è§é—®é¢˜è§£ç­”æ–‡æ¡£
- å®šæœŸç»„ç»‡åŸ¹è®­ï¼Œç¡®ä¿å›¢é˜Ÿäº†è§£é…ç½®æ–¹æ³•

## å…­ã€ä½¿ç”¨æŒ‡å—

### 6.1 åˆå§‹è®¾ç½®

1. åˆ›å»ºé…ç½®ç®¡ç†ä»“åº“
2. ç¼–å†™é…ç½®æ¨¡æ¿æ–‡ä»¶
3. åˆ›å»ºé¡¹ç›®åˆ—è¡¨æ–‡ä»¶
4. é…ç½®GitHub Secrets
5. è¿è¡Œåˆå§‹é…ç½®æ£€æŸ¥

### 6.2 æ—¥å¸¸ç»´æŠ¤

1. å®šæœŸè¿è¡Œé…ç½®æ£€æŸ¥è„šæœ¬
2. å¤„ç†æœªé…ç½®é¡¹ç›®
3. æ›´æ–°é…ç½®çŠ¶æ€æ–‡æ¡£
4. ä¼˜åŒ–é€šçŸ¥æ¨¡æ¿

### 6.3 æ–°å¢é¡¹ç›®

1. åœ¨é¡¹ç›®åˆ—è¡¨ä¸­æ·»åŠ æ–°é¡¹ç›®
2. è¿è¡Œéƒ¨ç½²è„šæœ¬
3. éªŒè¯é…ç½®æ˜¯å¦æˆåŠŸ
4. æ›´æ–°é…ç½®çŠ¶æ€æ–‡æ¡£

### 6.4 é…ç½®æ›´æ–°

1. ä¿®æ”¹é…ç½®æ¨¡æ¿
2. è¿è¡Œæ‰¹é‡æ›´æ–°è„šæœ¬
3. éªŒè¯æ›´æ–°æ•ˆæœ
4. æ›´æ–°é…ç½®çŠ¶æ€æ–‡æ¡£

é€šè¿‡ä»¥ä¸Šæ–¹æ¡ˆï¼Œå¯ä»¥æœ‰æ•ˆç®¡ç†å’Œè·Ÿè¸ªæ‰€æœ‰é¡¹ç›®çš„ä¼ä¸šå¾®ä¿¡é€šçŸ¥é…ç½®ï¼Œç¡®ä¿é€šçŸ¥ç³»ç»Ÿçš„ç¨³å®šè¿è¡Œå’ŒæŒç»­ç»´æŠ¤ã€‚